if command -v snap >/dev/null 2>&1; then
  for pass in 1 2 3 4; do
    mapfile -t snaps < <(snap list 2>/dev/null | awk 'NR>1 {print $1}' | sort -u || true)
    [[ ${#snaps[@]} -eq 0 ]] && break
    for s in "${snaps[@]}"; do
      [[ "${s}" == "snapd" ]] && continue
      sudo snap remove --purge "${s}" 2>/dev/null || true
    done
  done
  sudo snap remove --purge snapd 2>/dev/null || true
fi
